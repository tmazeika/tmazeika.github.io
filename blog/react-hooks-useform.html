<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>@font-face {
  font-display: swap;
  font-family: 'Source Code Pro';
  font-weight: 400;
  font-style: italic;
  src: local('Source Code Pro Italic'), local('SourceCodePro-Italic'), url('/assets/source-code-pro-italic.ttf') format('truetype');
}

@font-face {
  font-display: swap;
  font-family: 'Source Code Pro';
  font-weight: 400;
  src: local('Source Code Pro Regular'), local('SourceCodePro-Regular'), local('Source Code Pro'), url('/assets/source-code-pro-regular.ttf') format('truetype');
}

@font-face {
  font-display: swap;
  font-family: 'Source Sans Pro';
  font-weight: 700;
  src: local('Source Sans Pro Bold'), local('SourceSansPro-Bold'), url('/assets/source-sans-pro-bold.ttf') format('truetype');
}

@font-face {
  font-display: swap;
  font-family: 'Source Sans Pro';
  font-weight: 400;
  src: local('Source Sans Pro Regular'), local('SourceSansPro-Regular'), local('Source Sans Pro'), url('/assets/source-sans-pro-regular.ttf') format('truetype');
}</style><link rel="stylesheet" href="/assets/styles.css"><title>React Hooks: Build Your Own useForm() - TJ Mazeika</title></head><body><header class="header"><div><a href="/"><img class="header-img" src="/assets/me.webp" alt="Profile photo"></a><div class="header-title"><h1>TJ Mazeika</h1><code class="subtitle">Software Engineer</code></div></div><nav class="header-nav"><ul><li><a href="/">About</a></li><li><a href="https://mazeika.me/resume">Resume</a></li><li><a href="/blog">Blog</a></li></ul></nav></header><main class="content"><div class="post-header"><h2>React Hooks: Build Your Own useForm()</h2><code class="subtitle">30 Nov 2021</code></div><div><p>Forms in React are particularly tedious to implement because each input component demands its own <code>useState()</code> hook and
change handler.
There's <a href="https://final-form.org/react">a</a> <a href="https://react-hook-form.com/">ton</a> <a href="https://www.telerik.com/kendo-react-ui/components/form/">of</a> <a href="https://formik.org/">libraries</a>
out there that alleviate some of those pains and add validation utilities. But, unless you have a use case that calls
for any of those advanced features, you're probably better off writing your own hook. After
all, <a href="https://www.youtube.com/watch?v=PAAkCSZUG1c&amp;t=9m28s">a little copying is better than a little dependency</a>.</p>
<h2>Usage</h2>
<p>Before we get to the implementation, here's what we're trying to achieve:</p>
<pre class="filename"><code>App.tsx</code></pre>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">React</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;react&#39;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">useForm</span><span style="color: #ABB2BF">, { </span><span style="color: #E06C75">FormValueController</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;./useForm&#39;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">App</span><span style="color: #ABB2BF">(): </span><span style="color: #E5C07B">JSX</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">Element</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useForm</span><span style="color: #ABB2BF">({</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">initialValues</span><span style="color: #ABB2BF">: {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E06C75">name</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E06C75">email</span><span style="color: #ABB2BF">: </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">onValidate</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">values</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">errors</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// Setting at least one error here will prevent `onSubmit` from being</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// called.</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">values</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;Name cannot be empty.&#39;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">values</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">email</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">===</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;&#39;</span><span style="color: #ABB2BF">) </span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">email</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;Email cannot be empty.&#39;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// Can be async! With async, `form.isSubmitting` will be true until the</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// promise resolves. Without async, `form.isSubmitting` never turns to true.</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">onSubmit</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">values</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">alert</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">`Submitting name=</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">values</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #C678DD">}</span><span style="color: #98C379"> email=</span><span style="color: #C678DD">${</span><span style="color: #E5C07B">values</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">email</span><span style="color: #C678DD">}</span><span style="color: #98C379">`</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">    },</span></span>
<span class="line"><span style="color: #ABB2BF">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> (</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">form</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">onSubmit</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">onSubmit</span><span style="color: #C678DD">}</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66; font-style: italic">placeholder</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;Name&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66; font-style: italic">value</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">values</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// Note that &#39;name&#39; type checks and cannot be anything other than &#39;name&#39;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// or &#39;email&#39;. </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #D19A66; font-style: italic">onChange</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;name&#39;</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">      /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">{</span><span style="color: #7F848E; font-style: italic">/* Check for a name error and display it if it&#39;s not undefined. */</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> (</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">name</span><span style="color: #C678DD">}</span><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      )</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">{</span><span style="color: #7F848E; font-style: italic">/* Use `form.control()` to create a controller for a specific form value </span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">      that can get or set that value. */</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E5C07B">EmailInput</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">controller</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">control</span><span style="color: #ABB2BF">(</span><span style="color: #98C379">&#39;email&#39;</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">email</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">&amp;&amp;</span><span style="color: #ABB2BF"> (</span></span>
<span class="line"><span style="color: #ABB2BF">        &lt;</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">email</span><span style="color: #C678DD">}</span><span style="color: #ABB2BF">&lt;/</span><span style="color: #E06C75">p</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      )</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">type</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;submit&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">value</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;Submit&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">disabled</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">isSubmitting</span><span style="color: #C678DD">}</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E06C75">input</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">type</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;reset&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">value</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;Reset&quot;</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66; font-style: italic">onClick</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">form</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">reset</span><span style="color: #C678DD">}</span><span style="color: #ABB2BF"> /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;/</span><span style="color: #E06C75">form</span><span style="color: #ABB2BF">&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  );</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">EmailInputProps</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** A controller that gets and sets the value of this email input field. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">controller</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">FormValueController</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">&gt;;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">EmailInput</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">props</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">EmailInputProps</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">JSX</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">Element</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> (</span></span>
<span class="line"><span style="color: #ABB2BF">    &lt;</span><span style="color: #E06C75">input</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #D19A66; font-style: italic">placeholder</span><span style="color: #56B6C2">=</span><span style="color: #98C379">&quot;Email&quot;</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #D19A66; font-style: italic">value</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">controller</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #D19A66; font-style: italic">onChange</span><span style="color: #56B6C2">=</span><span style="color: #C678DD">{</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">props</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">controller</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">.</span><span style="color: #E5C07B">target</span><span style="color: #ABB2BF">.</span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">)</span><span style="color: #C678DD">}</span></span>
<span class="line"><span style="color: #ABB2BF">    /&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">  );</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">default</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">App</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span></code></pre>
<p>The best part about this is that everything is fully type checked. Given the hook's <code>initialValues</code> option, we can
guarantee that a value's type won't accidentally be changed (or be unexpectedly set to <code>undefined</code>, which is a
whole <a href="https://stackoverflow.com/questions/37427508/react-changing-an-uncontrolled-input">other problem</a>). See
that <code>form.set('name', 5)</code> won't type check, but it would if the initial value of <code>name</code> was a number. Nor
would <code>form.set('nmae', '...')</code> type check.</p>
<h2>Implementation</h2>
<pre class="filename"><code>useForm.ts</code></pre>
<pre class="shiki" style="background-color: #282c34"><code><span class="line"><span style="color: #C678DD">import</span><span style="color: #ABB2BF"> { </span><span style="color: #E06C75">SyntheticEvent</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">useCallback</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">useReducer</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">useState</span><span style="color: #ABB2BF"> } </span><span style="color: #C678DD">from</span><span style="color: #ABB2BF"> </span><span style="color: #98C379">&#39;react&#39;</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/** Controls a single form value. */</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FormValueController</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** The current value. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">readonly</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Readonly</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** Sets the value. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/** A map of form keys to errors found during their validation. */</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">type</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">FormErrors</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Partial</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">Record</span><span style="color: #ABB2BF">&lt;</span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">string</span><span style="color: #ABB2BF">&gt;&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">interface</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Form</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** All values of the form. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">readonly</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">values</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Readonly</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** Errors in the form. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">readonly</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">errors</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Readonly</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">FormErrors</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;&gt;;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** Whether the form is in the process of being submitted. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">readonly</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">isSubmitting</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">boolean</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** Sets a single value. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #E5C07B; font-style: italic">this</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">value</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">]): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/**</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   * Sets many values at once. Especially useful for prefilling data after a</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   * `fetch()`, for example.</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic">   */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">setMany</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B; font-style: italic">this</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">data</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Partial</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** Creates a controller for a value. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">control</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #E5C07B; font-style: italic">this</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">key</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">FormValueController</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">]&gt;;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** Submits this form after validating input. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">onSubmit</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B; font-style: italic">this</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">SyntheticEvent</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #7F848E; font-style: italic">/** Resets all values. */</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">reset</span><span style="color: #ABB2BF">(</span><span style="color: #E5C07B; font-style: italic">this</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color: #7F848E; font-style: italic">/**</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * Controls an HTML form.</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> *</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">initialValues</span><span style="color: #7F848E; font-style: italic"> The initial values of the form inputs.</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">onValidate</span><span style="color: #7F848E; font-style: italic">    Called to validate each input.</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> * </span><span style="color: #C678DD; font-style: italic">@param</span><span style="color: #7F848E; font-style: italic"> </span><span style="color: #E06C75; font-style: italic">onSubmit</span><span style="color: #7F848E; font-style: italic">      Called to submit the form.</span></span>
<span class="line"><span style="color: #7F848E; font-style: italic"> */</span></span>
<span class="line"><span style="color: #C678DD">export</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">default</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">function</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useForm</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;({</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75; font-style: italic">initialValues</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75; font-style: italic">onValidate</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75; font-style: italic">onSubmit</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">}: {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #E06C75">initialValues</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">onValidate</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">values</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Readonly</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;, </span><span style="color: #E06C75; font-style: italic">errors</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">FormErrors</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #61AFEF">onSubmit</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">values</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Readonly</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">Promise</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">&gt; | </span><span style="color: #E5C07B">void</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">}): </span><span style="color: #E5C07B">Form</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; {</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> [</span><span style="color: #E5C07B">values</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">dispatch</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useReducer</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// This reducer turns actions into reducers. See why in the `set()` function</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// below.</span></span>
<span class="line"><span style="color: #ABB2BF">    (</span><span style="color: #E06C75; font-style: italic">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">, </span><span style="color: #61AFEF">action</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">state</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">action</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">initialValues</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">  );</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> [</span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">setErrors</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useState</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">FormErrors</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;&gt;({});</span></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> [</span><span style="color: #E5C07B">isSubmitting</span><span style="color: #ABB2BF">, </span><span style="color: #E5C07B">setSubmitting</span><span style="color: #ABB2BF">] </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useState</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">set</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">useCallback</span><span style="color: #ABB2BF">(&lt;</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #E06C75; font-style: italic">k</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">v</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">dispatch</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">state</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// This action _is_ a reducer: only update the state when state[k] = v </span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// would actually change anything. This is done to avoid an infinite</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// update loop if `set` is called synchronously in a component&#39;s render </span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// function.</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">is</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">k</span><span style="color: #ABB2BF">], </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">?</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">state</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">:</span><span style="color: #ABB2BF"> { ...</span><span style="color: #E06C75">state</span><span style="color: #ABB2BF">, [</span><span style="color: #E06C75">k</span><span style="color: #ABB2BF">]: </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF"> });</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// Clear any errors for this key that may have been set due to a previously</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// failed submission. You might want to change this behavior depending on</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #7F848E; font-style: italic">// your desired UX.</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #61AFEF">setErrors</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">errors</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({ ...</span><span style="color: #E06C75">errors</span><span style="color: #ABB2BF">, [</span><span style="color: #E06C75">k</span><span style="color: #ABB2BF">]: </span><span style="color: #D19A66">undefined</span><span style="color: #ABB2BF"> }));</span></span>
<span class="line"><span style="color: #ABB2BF">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="color: #ABB2BF">  </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">values</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">errors</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">isSubmitting</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">set</span><span style="color: #ABB2BF">,</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">setMany</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">useCallback</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">      (</span><span style="color: #E06C75; font-style: italic">data</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">Partial</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;) </span><span style="color: #C678DD">=&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// `setMany` just calls `set` for each entry in `data`.</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">entries</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">data</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">forEach</span><span style="color: #ABB2BF">(([</span><span style="color: #E06C75; font-style: italic">k</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75; font-style: italic">v</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">=&gt;</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">k</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">as</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">])),</span></span>
<span class="line"><span style="color: #ABB2BF">      [</span><span style="color: #E06C75">set</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">    ),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">control</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">useCallback</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">      &lt;</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">extends</span><span style="color: #ABB2BF"> </span><span style="color: #C678DD">keyof</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt;(</span><span style="color: #E06C75; font-style: italic">k</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">): </span><span style="color: #E5C07B">FormValueController</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">]&gt; </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> ({</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E06C75">value</span><span style="color: #ABB2BF">: </span><span style="color: #E06C75">values</span><span style="color: #ABB2BF">[</span><span style="color: #E06C75">k</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// You can think of this as a curried `set()`.</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">: (</span><span style="color: #E06C75; font-style: italic">v</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">[</span><span style="color: #E5C07B">K</span><span style="color: #ABB2BF">]) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">set</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">k</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">v</span><span style="color: #ABB2BF">),</span></span>
<span class="line"><span style="color: #ABB2BF">      }),</span></span>
<span class="line"><span style="color: #ABB2BF">      [</span><span style="color: #E06C75">values</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">set</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">    ),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">onSubmit</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">useCallback</span><span style="color: #ABB2BF">(</span></span>
<span class="line"><span style="color: #ABB2BF">      (</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #C678DD">?</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">SyntheticEvent</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #E5C07B">e</span><span style="color: #ABB2BF">?.</span><span style="color: #61AFEF">preventDefault</span><span style="color: #ABB2BF">();</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">errors</span><span style="color: #ABB2BF">: </span><span style="color: #E5C07B">FormErrors</span><span style="color: #ABB2BF">&lt;</span><span style="color: #E5C07B">T</span><span style="color: #ABB2BF">&gt; </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> {};</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// Validation isn&#39;t required; we don&#39;t _have_ to pass in an `onValidate` </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// function.</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #61AFEF">onValidate</span><span style="color: #ABB2BF">?.(</span><span style="color: #E06C75">values</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">errors</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E5C07B">Object</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">values</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">errors</span><span style="color: #ABB2BF">).</span><span style="color: #61AFEF">some</span><span style="color: #ABB2BF">((</span><span style="color: #E06C75; font-style: italic">e</span><span style="color: #ABB2BF">) </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">e</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">!==</span><span style="color: #ABB2BF"> </span><span style="color: #D19A66">undefined</span><span style="color: #ABB2BF">)) {</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #61AFEF">setErrors</span><span style="color: #ABB2BF">(</span><span style="color: #E06C75">errors</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #C678DD">return</span><span style="color: #ABB2BF">;</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// Handling submission also isn&#39;t required; while it doesn&#39;t make much</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// sense for a production application, it might be nice to not have to</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// implement it right away during development.</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">const</span><span style="color: #ABB2BF"> </span><span style="color: #E5C07B">submit</span><span style="color: #ABB2BF"> </span><span style="color: #56B6C2">=</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">onSubmit</span><span style="color: #ABB2BF">?.(</span><span style="color: #E06C75">values</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// If `onSubmit` returns a Promise instead of void (or undefined if</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// there&#39;s no `onSubmit` function), then handle the `submitting` state </span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #7F848E; font-style: italic">// variable:</span></span>
<span class="line"><span style="color: #ABB2BF">        </span><span style="color: #C678DD">if</span><span style="color: #ABB2BF"> (</span><span style="color: #E06C75">submit</span><span style="color: #ABB2BF">) {</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #61AFEF">setSubmitting</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">true</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">// Warning! This may throw a React warning if the component using this</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">// hook unmounts (because the promise could resolve after unmount).</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">// You may want to create another hook that can create promises that</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #7F848E; font-style: italic">// don&#39;t resolve after a component unmounts.</span></span>
<span class="line"><span style="color: #ABB2BF">          </span><span style="color: #E5C07B">submit</span><span style="color: #ABB2BF">.</span><span style="color: #61AFEF">then</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #61AFEF">setSubmitting</span><span style="color: #ABB2BF">(</span><span style="color: #D19A66">false</span><span style="color: #ABB2BF">));</span></span>
<span class="line"><span style="color: #ABB2BF">        }</span></span>
<span class="line"><span style="color: #ABB2BF">      },</span></span>
<span class="line"><span style="color: #ABB2BF">      [</span><span style="color: #E06C75">onValidate</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">onSubmit</span><span style="color: #ABB2BF">, </span><span style="color: #E06C75">values</span><span style="color: #ABB2BF">],</span></span>
<span class="line"><span style="color: #ABB2BF">    ),</span></span>
<span class="line"><span style="color: #ABB2BF">    </span><span style="color: #E06C75">reset</span><span style="color: #ABB2BF">: </span><span style="color: #61AFEF">useCallback</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> {</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #7F848E; font-style: italic">// Clear everything.</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">dispatch</span><span style="color: #ABB2BF">(() </span><span style="color: #C678DD">=&gt;</span><span style="color: #ABB2BF"> </span><span style="color: #E06C75">initialValues</span><span style="color: #ABB2BF">);</span></span>
<span class="line"><span style="color: #ABB2BF">      </span><span style="color: #61AFEF">setErrors</span><span style="color: #ABB2BF">({});</span></span>
<span class="line"><span style="color: #ABB2BF">    }, [</span><span style="color: #E06C75">initialValues</span><span style="color: #ABB2BF">]),</span></span>
<span class="line"><span style="color: #ABB2BF">  };</span></span>
<span class="line"><span style="color: #ABB2BF">}</span></span>
<span class="line"></span></code></pre>
<p>There's a few things worth pointing out here, especially if you plan on modifying the code.</p>
<ol>
<li>The <code>(this: void)</code> parameters ensure that we don't get any TypeScript or IDE warnings when we destructure the
returned <code>Form</code> from <code>useForm()</code>. The only condition to using this is that we can't use <code>this</code> within the
returned <code>Form</code> object; luckily, we don't need it.</li>
<li>The liberal use of <code>useCallback()</code> ensures that functions on the returned <code>Form</code> object don't get unnecessarily
recreated every time a value changes. This is less about performance and more about allowing something like <code>set()</code>
or <code>setMany()</code> to be used in a <code>useEffect()</code> hook and its dependency array.</li>
</ol>
<h2>Conclusion</h2>
<p>Be on the lookout for more opportunities to replace large dependencies with hooks of your own. You'll know how they work
and how to extend them, all without worrying about other projects' breaking changes or their code licenses.</p>
</div><div id="disqus_thread"></div></main><footer class="footer muted"><ul class="footer-nav"><li>&copy; TJ Mazeika</li><li><a class="footer-nav-item" href="https://github.com/tmazeika"><img class="footer-ico" src="/assets/github.webp" alt="GitHub logo">/tmazeika</a></li><li><a class="footer-nav-item" href="https://www.linkedin.com/in/tj-mazeika/"><img class="footer-ico" src="/assets/linkedin.png" alt="LinkedIn logo">/tj-mazeika</a></li></ul></footer><script type="module">import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js';
import { getAnalytics } from 'https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js';

const app = initializeApp({
  apiKey: 'AIzaSyA-os9qsoSNm17fPiNrHx92Q7lsxUYcwiQ',
  authDomain: 'mazeika-me-8f757.firebaseapp.com',
  projectId: 'mazeika-me-8f757',
  storageBucket: 'mazeika-me-8f757.appspot.com',
  messagingSenderId: '696687148340',
  appId: '1:696687148340:web:5387ecfa72b70c3614b961',
});
const analytics = getAnalytics(app);</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"NewsArticle","headline":"React Hooks: Build Your Own useForm()","datePublished":"2021-11-30T00:00:00-05:00","author":{"@type":"Person","name":"TJ Mazeika","url":"/"}}</script><script>const disqus_config = function() {
  this.page.url = 'https://mazeika.me/blog/react-hooks-useform.html';
  this.page.identifier = 'react-hooks-useform';
};
(() => {
  const script = document.createElement('script');
  script.src = 'https://mazeika-me.disqus.com/embed.js';
  script.setAttribute('data-timestamp', String(new Date().valueOf()));
  document.body.append(script);
})();</script></body></html>